<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Form</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:700&display=swap&subset=cyrillic,cyrillic-ext" rel="stylesheet">
  <link rel="stylesheet" href="./main.css">
</head>
<body>
  <div class="maincontent">
    <div class="container">
      <header class="header">
       <div class="logo"></div>
       <div class="enter">
         <div class="enter__icon"></div>
         <button class="enter__button" type="button">Войти</button>
       </div> 
      </header>
      <main class="content">
        <h1 class="content__title">Начните торговать  прямо сейчас</h1>
        <ul class="content__list">
          <li class="content__item">
            <p class="content__text">Нет спреда — торгуйте с прозрачными и точными котировками</p>
          </li>
          <li class="content__item">
            <p class="content__text">Достаточно депозита в $10, чтобы начать торговать</p>
          </li>
        </ul>
        <form action="#" class="form" id="myForm" novalidate>
          <div class="form__row">
            <label for="email" class="email-label">Ваш e-mail</label>
            <input type="email" id='email', name='email', placeholder="samplemail@mail.com" class="form__input email" required>
          </div>
          <div class="form__row form__row_flex">
            <input type="password" id='password', name='password', placeholder="Придумайте пароль" class="form__input password" required minlength="4">
            <!-- <div class="form__error"></div> -->
          </div>
          
          <div class="form__row form__row_controlls controlls">
            <div class="controlls__text">Валюта для ввода и вывода средств</div>
            <div class="controlls__btns">
              <label class="radio">
                <input type="radio" name="currency"  value="rubles" class="radio__input" checked>
                <div class="radio-fake radio-fake_border-left">P</div>
              </label>
              <label class="radio">
                <input type="radio" name="currency" value="dollar" class="radio__input">
                <div class="radio-fake">S</div>
              </label>
              <label class="radio">
                <input type="radio" name="currency" value="euro" class="radio__input">
                <div class="radio-fake radio-fake_no-after radio-fake_border-right">E</div>
              </label>
            </div>
          </div>
          <div class="form__row form__row_controlls">
            <label class="form__checkbox">
              <input type="checkbox" name="agreement" id="agreement" class="form__check">
              <div class="form__checkbox_fake"></div>
              <div class="form__checkbox-title">Я совершеннолетний, ознакомился и принимаю соглашение об оказании услуг.</div>
            </label>
          </div>
          <div class="email__error">
            <img src="./img/attention.png" alt="" class="email__error-img">
            <p class="email__error-text">Учётная запись с указанным e-mail уже существует</p>
          </div>
          <div class="form__row form__row_button">
            <button class="checkin" type="submit">Зарегистрироваться</button>
          </div>
        </form>
      </main>
    </div>
    <div class="images">
      <img src="./img/dark.png" alt="" class="images__laptop">
      <img src="./img/frontal-black.png" alt="" class="images__phone">
    </div>
  </div>
  <script>
    const form = document.querySelector('#myForm');
    const sendBtn = document.querySelector('.checkin');
    const emails = ['ivanov@mail.ru', 'petrov@yandex.ru', 'zuev@inbox.ru'];
    const emailError = document.querySelector('.email__error');

    form.addEventListener('submit', e => {
      e.preventDefault();

    const password = form.elements.password;
    const email = form.elements.email;
    const agreement = form.elements.agreement;
    
      if(password.value === '') {
        addFormMessage(password, 'Поле не может быть пустым')
      } else if (password.value.length<4) {
        addFormMessage(password, 'Пароль должен быть не менее 4 символов');
      }

      if(email.value === '') {
        addFormMessage(email, 'Поле не может быть пустым')
      } else if(!validateEmail(email.value)) {
        addFormMessage(email, 'Не корректный почтовый адрес')
      } 

      for(var i=0; i<emails.length; i++ ){
        if(email.value === emails[i]) {
        emailError.style.display='flex';
        }
      }
      
      if(!agreement.checked) {
        addFormMessage(agreement, 'Требуется подтверждение')
      }
    });

    // при фокусе на инпут убираем класс ошибки
    [...form.elements].forEach((input) => {
      input.addEventListener('focus', e => {
        let elem = e.currentTarget.parentElement;

        let messElem = elem.querySelector('.form__error');
        if(messElem) {
          elem.removeChild(messElem);
        }

        elem.classList.remove('form__row_error');
      });
      agreement.addEventListener('change', e => {
        let elem = e.currentTarget.parentElement;

        let messElem = elem.querySelector('.form__error');
        if(messElem) {
          elem.removeChild(messElem);
        }

        elem.classList.remove('form__row_error');
      });
    });

    // добавляем (создаем) блок-сообщение об ошибке
    function addFormMessage(elem, message) {
      let parrent = elem.parentElement;

      let messageContainer = document.createElement('div');
      messageContainer.classList.add('form__error');
      messageContainer.innerHTML = message;
      parrent.appendChild(messageContainer);

      parrent.classList.add('form__row_error');
    }

    // валидация мыла
    function validateEmail(email) {
      var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return re.test(email);
    }
  </script>
</body>
</html>